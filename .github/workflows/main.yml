# .github/workflows/main.yml

name: Fikir-motoru CI/CD

# main dalına push veya pull request geldiğinde tetiklenir
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    # En güncel Ubuntu sürümünde çalıştır
    runs-on: ubuntu-latest

    strategy:
      matrix:
        # GÜNCELLEME BURADA: Node.js 18.x kaldırıldı, 22.x eklendi.
        # Paketleriniz en az Node.js 20.19.0 veya 22.12.0 gerektiriyor.
        node-version: [22.x]

    steps:
      # 1. Adım: Kodu (repository) sanal makineye indirir
      - name: Kodu al (Checkout)
        uses: actions/checkout@v4

      # 2. Adım: Node.js'i kurar
      - name: Node.js ${{ matrix.node-version }} sürümünü kur
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      # 3. Adım: Bağımlılıkları yükle (Hızlı ve tutarlı 'ci' komutu ile)
      - name: Bağımlılıkları yükle
        run: npm ci

      # 4. Adım: Build script'i varsa çalıştır
      - name: Projeyi derle (Build)
        run: npm run build --if-present

      # 5. Adım: Test script'i varsa çalıştır
      - name: Testleri çalıştır
        run: npm test --if-present
